(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3580:(e,t,o)=>{"use strict";o.d(t,{dj:()=>g});var s=o(2115);let r=0,n=new Map,a=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?a(o):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],l={toasts:[]};function d(e){l=i(l,e),c.forEach(e=>{e(l)})}function u(e){let{...t}=e,o=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:o});return d({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||s()}}}),{id:o,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function g(){let[e,t]=s.useState(l);return s.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},3999:(e,t,o)=>{"use strict";o.d(t,{cn:()=>n});var s=o(2596),r=o(9688);function n(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,r.QP)((0,s.$)(t))}},4128:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>k});var s=o(5155),r=o(2115),n=o(6874),a=o.n(n),i=o(5695),c=o(7168),l=o(9852),d=o(3580),u=o(1154),g=o(7971),m=o(7741);function f(e){let{isDoctor:t=!1}=e,[o,n]=(0,r.useState)(""),[f,h]=(0,r.useState)(""),[x,k]=(0,r.useState)(!1),[p,b]=(0,r.useState)(""),{toast:v}=(0,d.dj)(),y=(0,i.useRouter)(),T=async e=>{e.preventDefault(),k(!0),b("");try{if(console.log("Calling login API with:",{email:o,password:"[REDACTED]"}),t)try{let e=await fetch("https://8qgxh9alt4.execute-api.us-west-1.amazonaws.com/dev/doctor/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"login",credentials:{email:o,password:f}})});console.log("Doctor login API response status:",e.status);let t=await e.json();if(console.log("Doctor login API response data:",JSON.stringify(t)),200===e.status){console.log("Doctor login successful, attempting to extract tokens"),v({title:"Login successful",description:"Welcome back to your doctor dashboard"});try{if(t.body&&t.body.tokens){let{access_token:e,refresh_token:s,id_token:r}=t.body.tokens;e&&s&&r?((0,m.Ex)(e,s,r,o),console.log("Doctor tokens stored successfully with email:",o)):console.error("Missing one or more tokens in doctor login response")}else console.error("Tokens not found in expected structure:",JSON.stringify(t));localStorage.setItem("userEmail",o),console.log("Redirecting to doctor dashboard..."),window.location.href="/doctor-dashboard";return}catch(e){console.error("Error processing successful doctor login:",e),window.location.href="/doctor-dashboard";return}}if(400===e.status){let e="Login failed";if(t.body){if("string"==typeof t.body)try{e=JSON.parse(t.body).message||e}catch(o){console.error("Failed to parse error body:",o),t.body.includes("message")&&(e=t.body)}else t.body.message&&(e=t.body.message)}else t.message&&(e=t.message);console.error("Doctor login error (400):",e),b(e),v({title:"Login failed",description:e,variant:"destructive"}),k(!1);return}if(!e.ok)throw console.error("Doctor login API error:",t),Error(t.message||"Login failed");throw Error("Doctor login failed: Invalid response format")}catch(e){console.error("Doctor login fetch error:",e),b("Network error. Please check your connection and try again."),v({title:"Login failed",description:"Network error. Please check your connection and try again.",variant:"destructive"}),k(!1);return}let e=await fetch("https://8qgxh9alt4.execute-api.us-west-1.amazonaws.com/dev/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"login",credentials:{email:o,password:f}})});console.log("Login API response status:",e.status);let s=await e.json();if(console.log("Login API response data:",JSON.stringify(s)),200===e.status){console.log("Login successful, attempting to extract tokens"),v({title:"Login successful",description:"Welcome back to your dashboard"});try{if(s.body&&s.body.tokens){let{access_token:e,refresh_token:t,id_token:r}=s.body.tokens;if(e&&t&&r){console.log("[LOGIN] Received tokens from API:",{access_token_exists:!!e,refresh_token_exists:!!t,id_token_exists:!!r});let s=o;try{let e=r.split(".");if(3===e.length){let t=JSON.parse(atob(e[1]));t.email&&(s=t.email,console.log("[LOGIN] Extracted email from ID token: ".concat(s)))}}catch(e){console.error("[LOGIN] Error extracting email from ID token:",e)}(0,m.Ex)(e,t,r,s),console.log("Tokens stored successfully with email:",s),console.log("Verification - tokens stored properly:",{accessToken:!!localStorage.getItem("accessToken"),refreshToken:!!localStorage.getItem("refreshToken"),idToken:!!localStorage.getItem("idToken"),userEmail:localStorage.getItem("userEmail"),cookieToken:document.cookie.includes("accessToken")}),!function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=new Date;s.setTime(s.getTime()+864e5*o);let r="; expires="+s.toUTCString();document.cookie=e+"="+(t||"")+r+"; path=/"}("accessToken",e),console.log("Cookie verification:",{cookieExists:document.cookie.includes("accessToken"),cookieValue:document.cookie.split(";").find(e=>e.trim().startsWith("accessToken="))})}else console.error("Missing one or more tokens in response")}else console.error("Tokens not found in expected structure:",JSON.stringify(s));localStorage.setItem("userEmail",o),console.log("Redirecting to dashboard..."),setTimeout(()=>{console.log("Executing redirect now");try{window.location.href="/patient-dashboard"}catch(e){console.error("Redirect failed:",e),y.push("/patient-dashboard")}},1500);return}catch(e){console.error("Error processing successful login:",e),window.location.href="/patient-dashboard";return}}if(400===e.status){let e="Login failed";if(s.body){if("string"==typeof s.body)try{e=JSON.parse(s.body).message||e}catch(t){console.error("Failed to parse error body:",t),s.body.includes("message")&&(e=s.body)}else s.body.message&&(e=s.body.message)}else s.message&&(e=s.message);console.error("Login error (400):",e),b(e),v({title:"Login failed",description:e,variant:"destructive"}),k(!1);return}if(400===s.statusCode||s.body&&"string"==typeof s.body&&s.body.includes("error")){let e=s.body;if("string"==typeof s.body)try{e=JSON.parse(s.body)}catch(e){console.error("Failed to parse error body:",e)}let t=(null==e?void 0:e.message)||"Login failed";throw b(t),Error(t)}if(!e.ok)throw console.error("Login API error:",s),Error(s.message||"Login failed");throw Error("Login failed: Invalid response format")}catch(e){console.error("Login error:",e),v({title:"Login failed",description:e instanceof Error?e.message:"Please check your credentials and try again",variant:"destructive"})}finally{k(!1)}};return(0,s.jsxs)("div",{className:"space-y-8 bg-white dark:bg-[#1d1d1f] p-10 rounded-2xl shadow-[0_4px_30px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_30px_rgba(0,0,0,0.2)]",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-medium text-[#1d1d1f] dark:text-white",children:"Atlas"}),(0,s.jsx)("p",{className:"text-[#86868b] dark:text-[#a1a1a6] mt-1 text-sm",children:t?"Access your doctor dashboard":"Access your medical dashboard"})]}),(0,s.jsx)(g.U,{})]}),(0,s.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"email",className:"text-sm font-medium text-[#1d1d1f] dark:text-white",children:"Email"}),(0,s.jsx)(l.p,{id:"email",type:"email",value:o,onChange:e=>n(e.target.value),required:!0,className:"h-11 bg-[#f5f5f7] dark:bg-[#2c2c2e] border-0 rounded-lg px-4 text-[#1d1d1f] dark:text-white focus-visible:ring-1 focus-visible:ring-[#73a9e9] text-sm",placeholder:"email@example.com"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("label",{htmlFor:"password",className:"text-sm font-medium text-[#1d1d1f] dark:text-white",children:"Password"}),(0,s.jsx)(a(),{href:"/forgot-password",className:"text-xs text-[#73a9e9] hover:text-[#5a9ae6]",children:"Forgot password?"})]}),(0,s.jsx)(l.p,{id:"password",type:"password",value:f,onChange:e=>h(e.target.value),required:!0,className:"h-11 bg-[#f5f5f7] dark:bg-[#2c2c2e] border-0 rounded-lg px-4 text-[#1d1d1f] dark:text-white focus-visible:ring-1 focus-visible:ring-[#73a9e9] text-sm",placeholder:"••••••••"})]}),(0,s.jsx)(c.$,{type:"submit",className:"w-full h-11 bg-[#73a9e9] hover:bg-[#5a9ae6] text-white font-medium text-sm mt-4 rounded-lg transition-all",disabled:x,children:x?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"})," Signing in..."]}):"Sign in"}),p&&(0,s.jsx)("div",{className:"mt-2 text-center",children:(0,s.jsx)("p",{className:"text-red-500 text-sm",children:p})})]}),(0,s.jsx)("div",{className:"pt-2 text-center",children:(0,s.jsxs)("p",{className:"text-[#86868b] dark:text-[#a1a1a6] text-sm",children:["Don't have an account?"," ",(0,s.jsx)(a(),{href:t?"/doctor-signup":"/signup",className:"text-[#73a9e9] hover:text-[#5a9ae6]",children:"Create account"})]})})]})}var h=o(9304),x=o(3999);function k(){let[e,t]=(0,r.useState)(!1);return(0,s.jsx)(h.ThemeProvider,{children:(0,s.jsx)("main",{className:(0,x.cn)("min-h-screen flex flex-col items-center justify-center bg-[#f5f5f7] dark:bg-[#1d1d1f] transition-colors duration-300",e&&"bg-[#f0f7ff] dark:bg-[#1a1a2e]"),children:(0,s.jsxs)("div",{className:"w-full max-w-md space-y-6",children:[(0,s.jsx)("div",{className:"bg-white/50 dark:bg-[#2c2c2e]/50 backdrop-blur-sm rounded-xl p-1.5 shadow-lg",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("button",{onClick:()=>t(!1),className:(0,x.cn)("flex-1 py-3 px-6 rounded-lg text-sm font-medium transition-all duration-200",e?"text-[#86868b] dark:text-[#a1a1a6] hover:text-[#1d1d1f] dark:hover:text-white":"bg-white dark:bg-[#2c2c2e] text-[#1d1d1f] dark:text-white shadow-sm"),children:"Patient Login"}),(0,s.jsx)("button",{onClick:()=>t(!0),className:(0,x.cn)("flex-1 py-3 px-6 rounded-lg text-sm font-medium transition-all duration-200",e?"bg-white dark:bg-[#2c2c2e] text-[#1d1d1f] dark:text-white shadow-sm":"text-[#86868b] dark:text-[#a1a1a6] hover:text-[#1d1d1f] dark:hover:text-white"),children:"Doctor Login"})]})}),(0,s.jsx)(f,{isDoctor:e})]})})})}},7168:(e,t,o)=>{"use strict";o.d(t,{$:()=>l});var s=o(5155),r=o(2115),n=o(6634),a=o(2085),i=o(3999);let c=(0,a.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,t)=>{let{className:o,variant:r,size:a,asChild:l=!1,...d}=e,u=l?n.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(c({variant:r,size:a,className:o})),ref:t,...d})});l.displayName="Button"},7741:(e,t,o)=>{"use strict";o.d(t,{Ex:()=>a,O3:()=>m,RQ:()=>i,gf:()=>c,so:()=>g,wR:()=>l});let s=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;try{let s=new Date;s.setTime(s.getTime()+864e5*o);let r="; expires="+s.toUTCString();document.cookie=e+"="+(t||"")+r+"; path=/; SameSite=Lax",console.log("[TokenService] Cookie '".concat(e,"' set successfully"))}catch(t){console.error("[TokenService] Error setting cookie '".concat(e,"':"),t)}},r=e=>{try{let t=e+"=",o=document.cookie.split(";");for(let e=0;e<o.length;e++){let s=o[e];for(;" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return null}catch(t){return console.error("[TokenService] Error getting cookie '".concat(e,"':"),t),null}},n=e=>{let t=localStorage.getItem("accessToken"),o=localStorage.getItem("refreshToken"),s=localStorage.getItem("idToken"),n=r("accessToken");return console.log("[TokenService:".concat(e,"] accessToken exists in localStorage: ").concat(!!t)),console.log("[TokenService:".concat(e,"] refreshToken exists: ").concat(!!o)),console.log("[TokenService:".concat(e,"] idToken exists: ").concat(!!s)),console.log("[TokenService:".concat(e,"] accessToken exists in cookie: ").concat(!!n)),{accessToken:t,refreshToken:o,idToken:s,cookieToken:n}},a=(e,t,o,r)=>{console.log("[TokenService] Storing tokens..."),console.log("[TokenService] Tokens received for storage:",{access_token_exists:!!e,refresh_token_exists:!!t,id_token_exists:!!o,email:r||"not provided"});try{return localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t),localStorage.setItem("idToken",o),r&&(localStorage.setItem("userEmail",r),console.log("[TokenService] Storing email: ".concat(r))),s("accessToken",e,1),n("store"),!0}catch(e){return console.error("[TokenService] Error storing tokens:",e),!1}},i=()=>{let e={accessToken:localStorage.getItem("accessToken")||r("accessToken")||null,refreshToken:localStorage.getItem("refreshToken")||null,idToken:localStorage.getItem("idToken")||null};return console.log("[TokenService] Getting tokens:",{accessExists:!!e.accessToken,refreshExists:!!e.refreshToken,idExists:!!e.idToken}),e},c=()=>{console.log("[TokenService] Clearing tokens"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("idToken"),localStorage.removeItem("userEmail"),localStorage.removeItem("userRole"),s("accessToken","",-1),s("userRole","",-1),n("clear")},l=()=>{let e=localStorage.getItem("accessToken"),t=r("accessToken");return console.log("[TokenService] isAuthenticated check:",{localStorage:!!e,cookie:!!t}),!!e&&"undefined"!==e&&"null"!==e||!!t&&"undefined"!==t&&"null"!==t||(console.log("[TokenService] Invalid or missing access token in both localStorage and cookie"),!1)},d=()=>localStorage.getItem("userRole")||"provider",u=e=>{localStorage.setItem("userRole",e),s("userRole",e,7)},g=()=>{let e="provider"===d()?"patient":"provider";return u(e),e},m=async()=>(console.log("[TokenService] Token refresh requested but disabled"),null)},7971:(e,t,o)=>{"use strict";o.d(t,{U:()=>c});var s=o(5155),r=o(2098),n=o(3509),a=o(9304),i=o(7168);function c(){let{theme:e,setTheme:t}=(0,a.D)();return(0,s.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>t("light"===e?"dark":"light"),className:"\n        h-10 w-10 rounded-full \n        flex items-center justify-center \n        bg-[#e6f0ff] text-black \n        dark:bg-[#73a9e9] dark:text-white \n        transition-colors\n      ",children:[(0,s.jsx)(r.A,{className:"h-[18px] w-[18px] dark:hidden"}),(0,s.jsx)(n.A,{className:"h-[18px] w-[18px] hidden dark:block"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}},8252:(e,t,o)=>{Promise.resolve().then(o.bind(o,4128))},9304:(e,t,o)=>{"use strict";o.d(t,{D:()=>i,ThemeProvider:()=>a});var s=o(5155),r=o(2115);let n=(0,r.createContext)(void 0);function a(e){let{children:t}=e,[o,a]=(0,r.useState)("light"),[i,c]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;a(e||(t?"dark":"light")),c(!0)},[]),(0,r.useEffect)(()=>{i&&(document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(o),localStorage.setItem("theme",o))},[o,i]),i)?(0,s.jsx)(n.Provider,{value:{theme:o,setTheme:e=>{a(e)}},children:t}):null}let i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}},9852:(e,t,o)=>{"use strict";o.d(t,{p:()=>a});var s=o(5155),r=o(2115),n=o(3999);let a=r.forwardRef((e,t)=>{let{className:o,type:r,...a}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),ref:t,...a})});a.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[421,647,441,684,358],()=>t(8252)),_N_E=e.O()}]);